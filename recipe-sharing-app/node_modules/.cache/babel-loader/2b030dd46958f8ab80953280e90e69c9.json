{"ast":null,"code":"import axios from'axios';const API_BASE_URL=process.env.REACT_APP_API_BASE_URL||'http://localhost:5000/api';// Tạo instance axios với cấu hình mặc định\nconst api=axios.create({baseURL:API_BASE_URL,headers:{'Content-Type':'application/json'}});// Thêm interceptors để xử lý token authentication\napi.interceptors.request.use(config=>{const token=localStorage.getItem('auth_token');if(token){config.headers['Authorization']=\"Bearer \".concat(token);}return config;},error=>{return Promise.reject(error);});// Xử lý response và error global\napi.interceptors.response.use(response=>{return response;},async error=>{// Nếu lỗi là 401 (Unauthorized), thử lại với token mới\nif(error.response&&error.response.status===401){// Thông báo chi tiết hơn cho người dùng\nconsole.error(\"Authentication error:\",error.response.data);// Lưu URL hiện tại trước khi chuyển hướng\nlocalStorage.setItem('redirectAfterLogin',window.location.pathname);// Kiểm tra có phải là lỗi token hết hạn không\nconst errorMessage=error.response.data.message;if(errorMessage.includes('hết hạn')||errorMessage.includes('không hợp lệ')){alert('Phiên đăng nhập đã hết hạn. Vui lòng đăng nhập lại.');// Xóa token cũ\nlocalStorage.removeItem('auth_token');localStorage.removeItem('user');// Điều hướng đến trang đăng nhập\nwindow.location.href='/login';}}return Promise.reject(error);});// Example API calls\nexport const fetchRecipes=async()=>{const response=await api.get('/recipes');return response.data;};export const fetchRecipeById=async id=>{const response=await api.get(\"/recipes/\".concat(id));return response.data;};export const createRecipe=async recipeData=>{const response=await api.post('/recipes',recipeData);return response.data;};export const updateRecipe=async(id,recipeData)=>{const response=await api.put(\"/recipes/\".concat(id),recipeData);return response.data;};export const deleteRecipe=async id=>{const response=await api.delete(\"/recipes/\".concat(id));return response.data;};export default api;","map":{"version":3,"names":["axios","API_BASE_URL","process","env","REACT_APP_API_BASE_URL","api","create","baseURL","headers","interceptors","request","use","config","token","localStorage","getItem","concat","error","Promise","reject","response","status","console","data","setItem","window","location","pathname","errorMessage","message","includes","alert","removeItem","href","fetchRecipes","get","fetchRecipeById","id","createRecipe","recipeData","post","updateRecipe","put","deleteRecipe","delete"],"sources":["C:/Users/Lenovo/Documents/web_SE/recipe-sharing-app/src/services/api.js"],"sourcesContent":["import axios from 'axios';\n\nconst API_BASE_URL = process.env.REACT_APP_API_BASE_URL || 'http://localhost:5000/api';\n\n// Tạo instance axios với cấu hình mặc định\nconst api = axios.create({\n    baseURL: API_BASE_URL,\n    headers: {\n        'Content-Type': 'application/json',\n    },\n});\n\n// Thêm interceptors để xử lý token authentication\napi.interceptors.request.use(\n    (config) => {\n        const token = localStorage.getItem('auth_token');\n        if (token) {\n            config.headers['Authorization'] = `Bearer ${token}`;\n        }\n        return config;\n    },\n    (error) => {\n        return Promise.reject(error);\n    }\n);\n\n// Xử lý response và error global\napi.interceptors.response.use(\n    (response) => {\n        return response;\n    },\n    async (error) => {\n        // Nếu lỗi là 401 (Unauthorized), thử lại với token mới\n        if (error.response && error.response.status === 401) {\n            // Thông báo chi tiết hơn cho người dùng\n            console.error(\"Authentication error:\", error.response.data);\n            \n            // Lưu URL hiện tại trước khi chuyển hướng\n            localStorage.setItem('redirectAfterLogin', window.location.pathname);\n            \n            // Kiểm tra có phải là lỗi token hết hạn không\n            const errorMessage = error.response.data.message;\n            if (errorMessage.includes('hết hạn') || errorMessage.includes('không hợp lệ')) {\n                alert('Phiên đăng nhập đã hết hạn. Vui lòng đăng nhập lại.');\n                \n                // Xóa token cũ\n                localStorage.removeItem('auth_token');\n                localStorage.removeItem('user');\n                \n                // Điều hướng đến trang đăng nhập\n                window.location.href = '/login';\n            }\n        }\n        return Promise.reject(error);\n    }\n);\n\n// Example API calls\nexport const fetchRecipes = async () => {\n    const response = await api.get('/recipes');\n    return response.data;\n};\n\nexport const fetchRecipeById = async (id) => {\n    const response = await api.get(`/recipes/${id}`);\n    return response.data;\n};\n\nexport const createRecipe = async (recipeData) => {\n    const response = await api.post('/recipes', recipeData);\n    return response.data;\n};\n\nexport const updateRecipe = async (id, recipeData) => {\n    const response = await api.put(`/recipes/${id}`, recipeData);\n    return response.data;\n};\n\nexport const deleteRecipe = async (id) => {\n    const response = await api.delete(`/recipes/${id}`);\n    return response.data;\n};\n\nexport default api;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}