{"ast":null,"code":"const setupFetchInterceptor = () => {\n  const originalFetch = window.fetch;\n  window.fetch = async function (url, options = {}) {\n    // Nếu là request API, thêm token vào header\n    if (url.includes('http://localhost:5000/api')) {\n      // Chỉ sử dụng key 'token'\n      const token = localStorage.getItem('token');\n      if (token) {\n        console.log(`Adding auth token to ${url}`);\n        options.headers = {\n          ...options.headers,\n          'Authorization': `Bearer ${token}`\n        };\n      } else {\n        console.log(`No token found for ${url}`);\n      }\n    }\n    try {\n      const response = await originalFetch(url, options);\n\n      // Kiểm tra response\n      if (response.status === 401) {\n        // Token không hợp lệ hoặc hết hạn\n        console.warn('Authentication failed. Logging out...');\n        localStorage.removeItem('token');\n        localStorage.removeItem('user');\n\n        // Chuyển hướng đến trang đăng nhập nếu không phải đang ở đó\n        if (!window.location.pathname.includes('/login')) {\n          window.location.href = '/login';\n        }\n      }\n      return response;\n    } catch (error) {\n      console.error('Fetch error:', error);\n      throw error;\n    }\n  };\n};\nexport default setupFetchInterceptor;","map":{"version":3,"names":["setupFetchInterceptor","originalFetch","window","fetch","url","options","includes","token","localStorage","getItem","console","log","headers","response","status","warn","removeItem","location","pathname","href","error"],"sources":["C:/Users/Lenovo/Documents/web_SE/recipe-sharing-app/src/utils/fetchInterceptor.js"],"sourcesContent":["const setupFetchInterceptor = () => {\r\n  const originalFetch = window.fetch;\r\n  \r\n  window.fetch = async function(url, options = {}) {\r\n    // Nếu là request API, thêm token vào header\r\n    if (url.includes('http://localhost:5000/api')) {\r\n      // Chỉ sử dụng key 'token'\r\n      const token = localStorage.getItem('token');\r\n      \r\n      if (token) {\r\n        console.log(`Adding auth token to ${url}`);\r\n        options.headers = {\r\n          ...options.headers,\r\n          'Authorization': `Bearer ${token}`\r\n        };\r\n      } else {\r\n        console.log(`No token found for ${url}`);\r\n      }\r\n    }\r\n    \r\n    try {\r\n      const response = await originalFetch(url, options);\r\n      \r\n      // Kiểm tra response\r\n      if (response.status === 401) {\r\n        // Token không hợp lệ hoặc hết hạn\r\n        console.warn('Authentication failed. Logging out...');\r\n        localStorage.removeItem('token');\r\n        localStorage.removeItem('user');\r\n        \r\n        // Chuyển hướng đến trang đăng nhập nếu không phải đang ở đó\r\n        if (!window.location.pathname.includes('/login')) {\r\n          window.location.href = '/login';\r\n        }\r\n      }\r\n      \r\n      return response;\r\n    } catch (error) {\r\n      console.error('Fetch error:', error);\r\n      throw error;\r\n    }\r\n  };\r\n};\r\n\r\nexport default setupFetchInterceptor;"],"mappings":"AAAA,MAAMA,qBAAqB,GAAGA,CAAA,KAAM;EAClC,MAAMC,aAAa,GAAGC,MAAM,CAACC,KAAK;EAElCD,MAAM,CAACC,KAAK,GAAG,gBAAeC,GAAG,EAAEC,OAAO,GAAG,CAAC,CAAC,EAAE;IAC/C;IACA,IAAID,GAAG,CAACE,QAAQ,CAAC,2BAA2B,CAAC,EAAE;MAC7C;MACA,MAAMC,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;MAE3C,IAAIF,KAAK,EAAE;QACTG,OAAO,CAACC,GAAG,CAAC,wBAAwBP,GAAG,EAAE,CAAC;QAC1CC,OAAO,CAACO,OAAO,GAAG;UAChB,GAAGP,OAAO,CAACO,OAAO;UAClB,eAAe,EAAE,UAAUL,KAAK;QAClC,CAAC;MACH,CAAC,MAAM;QACLG,OAAO,CAACC,GAAG,CAAC,sBAAsBP,GAAG,EAAE,CAAC;MAC1C;IACF;IAEA,IAAI;MACF,MAAMS,QAAQ,GAAG,MAAMZ,aAAa,CAACG,GAAG,EAAEC,OAAO,CAAC;;MAElD;MACA,IAAIQ,QAAQ,CAACC,MAAM,KAAK,GAAG,EAAE;QAC3B;QACAJ,OAAO,CAACK,IAAI,CAAC,uCAAuC,CAAC;QACrDP,YAAY,CAACQ,UAAU,CAAC,OAAO,CAAC;QAChCR,YAAY,CAACQ,UAAU,CAAC,MAAM,CAAC;;QAE/B;QACA,IAAI,CAACd,MAAM,CAACe,QAAQ,CAACC,QAAQ,CAACZ,QAAQ,CAAC,QAAQ,CAAC,EAAE;UAChDJ,MAAM,CAACe,QAAQ,CAACE,IAAI,GAAG,QAAQ;QACjC;MACF;MAEA,OAAON,QAAQ;IACjB,CAAC,CAAC,OAAOO,KAAK,EAAE;MACdV,OAAO,CAACU,KAAK,CAAC,cAAc,EAAEA,KAAK,CAAC;MACpC,MAAMA,KAAK;IACb;EACF,CAAC;AACH,CAAC;AAED,eAAepB,qBAAqB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}