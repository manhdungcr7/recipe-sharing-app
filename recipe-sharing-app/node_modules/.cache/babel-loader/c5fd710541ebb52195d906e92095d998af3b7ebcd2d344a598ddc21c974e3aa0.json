{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Lenovo\\\\Documents\\\\web_SE\\\\recipe-sharing-app\\\\src\\\\pages\\\\UserProfilePage.jsx\",\n  _s = $RefreshSig$();\nimport React, { useContext, useEffect, useState } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { AuthContext } from '../context/AuthContext';\nimport ProfileHeader from '../components/profile/ProfileHeader';\nimport UserPosts from '../components/profile/UserPosts';\nimport UserStats from '../components/profile/UserStats';\nimport Followers from '../components/profile/Followers';\nimport Following from '../components/profile/Following';\nimport useAuth from '../hooks/useAuth';\nimport ProfileLayout from './ProfileLayout';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst UserProfilePage = () => {\n  _s();\n  const {\n    currentUser,\n    isAuthenticated\n  } = useAuth();\n  const {\n    userId\n  } = useParams();\n  const navigate = useNavigate();\n  const [loading, setLoading] = useState(true);\n  const [profileData, setProfileData] = useState(null);\n  const [error, setError] = useState(null);\n  const [isFollowing, setIsFollowing] = useState(false);\n  const [stats, setStats] = useState({\n    followerCount: 0,\n    followingCount: 0,\n    postCount: 0\n  });\n\n  // Debug\n  console.log(\"UserProfilePage render - currentUser:\", currentUser);\n  console.log(\"UserProfilePage render - userId from params:\", userId);\n  useEffect(() => {\n    const fetchProfileData = async () => {\n      try {\n        setLoading(true);\n        setError(null);\n        // Sử dụng currentUser nếu không có userId và người dùng đã đăng nhập\n        if (!userId && currentUser) {\n          console.log(\"Using currentUser data:\", currentUser);\n          setProfileData(currentUser);\n          setStats({\n            followerCount: currentUser.followerCount || 0,\n            followingCount: currentUser.followingCount || 0,\n            postCount: currentUser.postCount || 0\n          });\n          setLoading(false);\n          return;\n        }\n\n        // Sử dụng userId từ URL nếu có\n        if (userId) {\n          console.log(\"Fetching profile for userId:\", userId);\n          const token = localStorage.getItem('token');\n          const headers = token ? {\n            'Authorization': `Bearer ${token}`\n          } : {};\n          const response = await fetch(`http://localhost:5000/api/users/${userId}`, {\n            headers\n          });\n          if (!response.ok) throw new Error('Không thể tải thông tin người dùng');\n          const data = await response.json();\n          console.log(\"Profile data received:\", data);\n          setProfileData(data.data);\n          setStats({\n            followerCount: data.data.followerCount || 0,\n            followingCount: data.data.followingCount || 0,\n            postCount: data.data.postCount || 0\n          });\n        } else if (!currentUser) {\n          // Không có userId và không có currentUser\n          console.log(\"No userId or currentUser, redirecting to login\");\n          navigate('/login');\n          return;\n        }\n      } catch (error) {\n        console.error(\"Error fetching user profile:\", error);\n        setError('Không thể tải thông tin người dùng');\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchProfileData();\n  }, [userId, currentUser, navigate]);\n  useEffect(() => {\n    // Kiểm tra trạng thái theo dõi\n    const fetchFollowStatus = async () => {\n      const token = localStorage.getItem('auth_token');\n      const res = await fetch(`http://localhost:5000/api/users/${userId}/follow-status`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      });\n      if (res.ok) {\n        const data = await res.json();\n        setIsFollowing(data.following);\n      }\n    };\n    fetchFollowStatus();\n  }, [userId]);\n  const handleFollowToggle = async () => {\n    const token = localStorage.getItem('auth_token');\n    const endpoint = isFollowing ? 'unfollow' : 'follow';\n    const res = await fetch(`http://localhost:5000/api/users/${userId}/${endpoint}`, {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${token}`\n      }\n    });\n    if (res.ok) {\n      setIsFollowing(!isFollowing);\n      setStats(prev => ({\n        ...prev,\n        followerCount: isFollowing ? prev.followerCount - 1 : prev.followerCount + 1\n      }));\n    }\n  };\n  useEffect(() => {\n    if (currentUser && String(currentUser.id) === String(userId)) {\n      navigate('/dashboard', {\n        replace: true\n      });\n    }\n  }, [currentUser, userId, navigate]);\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"loading\",\n      children: \"\\u0110ang t\\u1EA3i...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 16\n    }, this);\n  }\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"error\",\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 16\n    }, this);\n  }\n  if (!profileData) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"error\",\n      children: \"Kh\\xF4ng th\\u1EC3 t\\u1EA3i th\\xF4ng tin ng\\u01B0\\u1EDDi d\\xF9ng\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 16\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"user-profile-page\",\n    children: /*#__PURE__*/_jsxDEV(ProfileLayout, {\n      user: profileData,\n      stats: stats,\n      setStats: setStats,\n      isOwner: false,\n      isFollowing: isFollowing,\n      onFollowToggle: handleFollowToggle\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 133,\n    columnNumber: 9\n  }, this);\n};\n_s(UserProfilePage, \"tqVQ+67WA+u2aWjSc+AZXcMSvQ0=\", false, function () {\n  return [useAuth, useParams, useNavigate];\n});\n_c = UserProfilePage;\nexport default UserProfilePage;\nvar _c;\n$RefreshReg$(_c, \"UserProfilePage\");","map":{"version":3,"names":["React","useContext","useEffect","useState","useParams","useNavigate","AuthContext","ProfileHeader","UserPosts","UserStats","Followers","Following","useAuth","ProfileLayout","jsxDEV","_jsxDEV","UserProfilePage","_s","currentUser","isAuthenticated","userId","navigate","loading","setLoading","profileData","setProfileData","error","setError","isFollowing","setIsFollowing","stats","setStats","followerCount","followingCount","postCount","console","log","fetchProfileData","token","localStorage","getItem","headers","response","fetch","ok","Error","data","json","fetchFollowStatus","res","following","handleFollowToggle","endpoint","method","prev","String","id","replace","className","children","fileName","_jsxFileName","lineNumber","columnNumber","user","isOwner","onFollowToggle","_c","$RefreshReg$"],"sources":["C:/Users/Lenovo/Documents/web_SE/recipe-sharing-app/src/pages/UserProfilePage.jsx"],"sourcesContent":["import React, { useContext, useEffect, useState } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { AuthContext } from '../context/AuthContext';\nimport ProfileHeader from '../components/profile/ProfileHeader';\nimport UserPosts from '../components/profile/UserPosts';\nimport UserStats from '../components/profile/UserStats';\nimport Followers from '../components/profile/Followers';\nimport Following from '../components/profile/Following';\nimport useAuth from '../hooks/useAuth';\nimport ProfileLayout from './ProfileLayout';\n\nconst UserProfilePage = () => {\n    const { currentUser, isAuthenticated } = useAuth();\n    const { userId } = useParams();\n    const navigate = useNavigate();\n    const [loading, setLoading] = useState(true);\n    const [profileData, setProfileData] = useState(null);\n    const [error, setError] = useState(null);\n    const [isFollowing, setIsFollowing] = useState(false);\n    const [stats, setStats] = useState({\n        followerCount: 0,\n        followingCount: 0,\n        postCount: 0\n    });\n\n    // Debug\n    console.log(\"UserProfilePage render - currentUser:\", currentUser);\n    console.log(\"UserProfilePage render - userId from params:\", userId);\n\n    useEffect(() => {\n        const fetchProfileData = async () => {\n            try {\n                setLoading(true);\n                setError(null);\n                // Sử dụng currentUser nếu không có userId và người dùng đã đăng nhập\n                if (!userId && currentUser) {\n                    console.log(\"Using currentUser data:\", currentUser);\n                    setProfileData(currentUser);\n                    setStats({\n                        followerCount: currentUser.followerCount || 0,\n                        followingCount: currentUser.followingCount || 0,\n                        postCount: currentUser.postCount || 0\n                    });\n                    setLoading(false);\n                    return;\n                }\n                \n                // Sử dụng userId từ URL nếu có\n                if (userId) {\n                    console.log(\"Fetching profile for userId:\", userId);\n                    const token = localStorage.getItem('token');\n                    const headers = token ? { 'Authorization': `Bearer ${token}` } : {};\n                    \n                    const response = await fetch(`http://localhost:5000/api/users/${userId}`, { headers });\n                    \n                    if (!response.ok) throw new Error('Không thể tải thông tin người dùng');\n                    \n                    const data = await response.json();\n                    console.log(\"Profile data received:\", data);\n                    setProfileData(data.data);\n                    setStats({\n                        followerCount: data.data.followerCount || 0,\n                        followingCount: data.data.followingCount || 0,\n                        postCount: data.data.postCount || 0\n                    });\n                } else if (!currentUser) {\n                    // Không có userId và không có currentUser\n                    console.log(\"No userId or currentUser, redirecting to login\");\n                    navigate('/login');\n                    return;\n                }\n            } catch (error) {\n                console.error(\"Error fetching user profile:\", error);\n                setError('Không thể tải thông tin người dùng');\n            } finally {\n                setLoading(false);\n            }\n        };\n        \n        fetchProfileData();\n    }, [userId, currentUser, navigate]);\n    \n    useEffect(() => {\n        // Kiểm tra trạng thái theo dõi\n        const fetchFollowStatus = async () => {\n            const token = localStorage.getItem('auth_token');\n            const res = await fetch(`http://localhost:5000/api/users/${userId}/follow-status`, {\n                headers: { 'Authorization': `Bearer ${token}` }\n            });\n            if (res.ok) {\n                const data = await res.json();\n                setIsFollowing(data.following);\n            }\n        };\n        fetchFollowStatus();\n    }, [userId]);\n\n    const handleFollowToggle = async () => {\n        const token = localStorage.getItem('auth_token');\n        const endpoint = isFollowing ? 'unfollow' : 'follow';\n        const res = await fetch(`http://localhost:5000/api/users/${userId}/${endpoint}`, {\n            method: 'POST',\n            headers: { 'Authorization': `Bearer ${token}` }\n        });\n        if (res.ok) {\n            setIsFollowing(!isFollowing);\n            setStats(prev => ({\n                ...prev,\n                followerCount: isFollowing ? prev.followerCount - 1 : prev.followerCount + 1\n            }));\n        }\n    };\n    \n    useEffect(() => {\n        if (currentUser && String(currentUser.id) === String(userId)) {\n            navigate('/dashboard', { replace: true });\n        }\n    }, [currentUser, userId, navigate]);\n\n    if (loading) {\n        return <div className=\"loading\">Đang tải...</div>;\n    }\n    \n    if (error) {\n        return <div className=\"error\">{error}</div>;\n    }\n\n    if (!profileData) {\n        return <div className=\"error\">Không thể tải thông tin người dùng</div>;\n    }\n\n    return (\n        <div className=\"user-profile-page\">\n            <ProfileLayout\n                user={profileData}\n                stats={stats}\n                setStats={setStats}\n                isOwner={false}\n                isFollowing={isFollowing}\n                onFollowToggle={handleFollowToggle}\n            />\n        </div>\n    );\n};\n\nexport default UserProfilePage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}