{"ast":null,"code":"// Tạo file utility để xử lý API requests\nexport const getAuthToken = () => {\n  const token = localStorage.getItem('token');\n\n  // Kiểm tra token có giá trị và đúng định dạng không\n  if (!token || token === 'null' || token === 'undefined') {\n    return null;\n  }\n\n  // Kiểm tra thêm xem có cấu trúc đúng của JWT không (có 3 phần)\n  const parts = token.split('.');\n  if (parts.length !== 3) {\n    console.error(\"Invalid token format in localStorage\");\n    localStorage.removeItem('token'); // Xóa token không hợp lệ\n    return null;\n  }\n  return token;\n};\nexport const getAuthHeaders = () => {\n  const token = getAuthToken();\n  return token ? {\n    'Authorization': `Bearer ${token}`\n  } : {};\n};\nexport const apiRequest = async (url, options = {}) => {\n  const token = getAuthToken();\n  const headers = {\n    ...options.headers,\n    ...(token ? {\n      'Authorization': `Bearer ${token}`\n    } : {})\n  };\n  const response = await fetch(`http://localhost:5000${url}`, {\n    ...options,\n    headers\n  });\n  if (response.status === 401) {\n    // Token hết hạn hoặc không hợp lệ\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n\n    // Lưu đường dẫn hiện tại để quay lại sau khi đăng nhập\n    localStorage.setItem('redirectAfterLogin', window.location.pathname);\n\n    // Chuyển hướng đến trang đăng nhập\n    window.location.href = '/login';\n    throw new Error('Token hết hạn. Vui lòng đăng nhập lại.');\n  }\n  return response;\n};","map":{"version":3,"names":["getAuthToken","token","localStorage","getItem","parts","split","length","console","error","removeItem","getAuthHeaders","apiRequest","url","options","headers","response","fetch","status","setItem","window","location","pathname","href","Error"],"sources":["C:/Users/Lenovo/Documents/web_SE/recipe-sharing-app/src/utils/apiUtils.js"],"sourcesContent":["// Tạo file utility để xử lý API requests\r\nexport const getAuthToken = () => {\r\n  const token = localStorage.getItem('token');\r\n  \r\n  // Kiểm tra token có giá trị và đúng định dạng không\r\n  if (!token || token === 'null' || token === 'undefined') {\r\n    return null;\r\n  }\r\n  \r\n  // Kiểm tra thêm xem có cấu trúc đúng của JWT không (có 3 phần)\r\n  const parts = token.split('.');\r\n  if (parts.length !== 3) {\r\n    console.error(\"Invalid token format in localStorage\");\r\n    localStorage.removeItem('token'); // Xóa token không hợp lệ\r\n    return null;\r\n  }\r\n  \r\n  return token;\r\n};\r\n\r\nexport const getAuthHeaders = () => {\r\n  const token = getAuthToken();\r\n  return token ? { 'Authorization': `Bearer ${token}` } : {};\r\n};\r\n\r\nexport const apiRequest = async (url, options = {}) => {\r\n  const token = getAuthToken();\r\n  \r\n  const headers = {\r\n    ...options.headers,\r\n    ...(token ? { 'Authorization': `Bearer ${token}` } : {})\r\n  };\r\n  \r\n  const response = await fetch(`http://localhost:5000${url}`, {\r\n    ...options,\r\n    headers\r\n  });\r\n  \r\n  if (response.status === 401) {\r\n    // Token hết hạn hoặc không hợp lệ\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('user');\r\n    \r\n    // Lưu đường dẫn hiện tại để quay lại sau khi đăng nhập\r\n    localStorage.setItem('redirectAfterLogin', window.location.pathname);\r\n    \r\n    // Chuyển hướng đến trang đăng nhập\r\n    window.location.href = '/login';\r\n    throw new Error('Token hết hạn. Vui lòng đăng nhập lại.');\r\n  }\r\n  \r\n  return response;\r\n};"],"mappings":"AAAA;AACA,OAAO,MAAMA,YAAY,GAAGA,CAAA,KAAM;EAChC,MAAMC,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;;EAE3C;EACA,IAAI,CAACF,KAAK,IAAIA,KAAK,KAAK,MAAM,IAAIA,KAAK,KAAK,WAAW,EAAE;IACvD,OAAO,IAAI;EACb;;EAEA;EACA,MAAMG,KAAK,GAAGH,KAAK,CAACI,KAAK,CAAC,GAAG,CAAC;EAC9B,IAAID,KAAK,CAACE,MAAM,KAAK,CAAC,EAAE;IACtBC,OAAO,CAACC,KAAK,CAAC,sCAAsC,CAAC;IACrDN,YAAY,CAACO,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC;IAClC,OAAO,IAAI;EACb;EAEA,OAAOR,KAAK;AACd,CAAC;AAED,OAAO,MAAMS,cAAc,GAAGA,CAAA,KAAM;EAClC,MAAMT,KAAK,GAAGD,YAAY,CAAC,CAAC;EAC5B,OAAOC,KAAK,GAAG;IAAE,eAAe,EAAE,UAAUA,KAAK;EAAG,CAAC,GAAG,CAAC,CAAC;AAC5D,CAAC;AAED,OAAO,MAAMU,UAAU,GAAG,MAAAA,CAAOC,GAAG,EAAEC,OAAO,GAAG,CAAC,CAAC,KAAK;EACrD,MAAMZ,KAAK,GAAGD,YAAY,CAAC,CAAC;EAE5B,MAAMc,OAAO,GAAG;IACd,GAAGD,OAAO,CAACC,OAAO;IAClB,IAAIb,KAAK,GAAG;MAAE,eAAe,EAAE,UAAUA,KAAK;IAAG,CAAC,GAAG,CAAC,CAAC;EACzD,CAAC;EAED,MAAMc,QAAQ,GAAG,MAAMC,KAAK,CAAC,wBAAwBJ,GAAG,EAAE,EAAE;IAC1D,GAAGC,OAAO;IACVC;EACF,CAAC,CAAC;EAEF,IAAIC,QAAQ,CAACE,MAAM,KAAK,GAAG,EAAE;IAC3B;IACAf,YAAY,CAACO,UAAU,CAAC,OAAO,CAAC;IAChCP,YAAY,CAACO,UAAU,CAAC,MAAM,CAAC;;IAE/B;IACAP,YAAY,CAACgB,OAAO,CAAC,oBAAoB,EAAEC,MAAM,CAACC,QAAQ,CAACC,QAAQ,CAAC;;IAEpE;IACAF,MAAM,CAACC,QAAQ,CAACE,IAAI,GAAG,QAAQ;IAC/B,MAAM,IAAIC,KAAK,CAAC,wCAAwC,CAAC;EAC3D;EAEA,OAAOR,QAAQ;AACjB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}